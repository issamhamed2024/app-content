(function(){var e={8697:function(e,t,r){"use strict";var n=r(5130),a=r(6768);function s(e,t,r,n,s,o){const i=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.Wv)(i)}var o={name:"App"},i=r(1241);const l=(0,i.A)(o,[["render",s]]);var u=l,d=r(1387),c=r(4232);const h=e=>((0,a.Qi)("data-v-c724056e"),e=e(),(0,a.jt)(),e),m={class:"form-container"},p=h((()=>(0,a.Lk)("h1",null,"تقديم النموذج",-1))),f=h((()=>(0,a.Lk)("label",null,"الاسم:",-1))),g={key:0,class:"error"},b=h((()=>(0,a.Lk)("label",null,"رقم الهاتف:",-1))),v={key:1,class:"error"},k=h((()=>(0,a.Lk)("button",{type:"submit"},"إرسال",-1))),y={key:2,class:"error"};function L(e,t,r,s,o,i){return(0,a.uX)(),(0,a.CE)("div",m,[p,(0,a.Lk)("form",{onSubmit:t[2]||(t[2]=(0,n.D$)(((...e)=>i.submitForm&&i.submitForm(...e)),["prevent"])),class:"form"},[f,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.name=e),required:""},null,512),[[n.Jo,o.name]]),o.errors.name?((0,a.uX)(),(0,a.CE)("span",g,(0,c.v_)(o.errors.name),1)):(0,a.Q3)("",!0),b,(0,a.bo)((0,a.Lk)("input",{type:"tel","onUpdate:modelValue":t[1]||(t[1]=e=>o.phoneNumber=e),required:"",placeholder:"+966"},null,512),[[n.Jo,o.phoneNumber]]),o.errors.phoneNumber?((0,a.uX)(),(0,a.CE)("span",v,(0,c.v_)(o.errors.phoneNumber),1)):(0,a.Q3)("",!0),k,o.formError?((0,a.uX)(),(0,a.CE)("span",y,(0,c.v_)(o.formError),1)):(0,a.Q3)("",!0)],32)])}var w=r(8355);const D="http://maabada.net";var E={data(){return{name:"",phoneNumber:"+966",errors:{},formError:""}},methods:{async submitForm(){if(this.errors={},this.formError="",this.name||(this.errors.name="الرجاء إدخال الاسم"),this.phoneNumber||(this.errors.phoneNumber="الرجاء إدخال رقم الهاتف"),!(Object.keys(this.errors).length>0))try{await w.A.post(`${D}/api/forms`,{name:this.name,phoneNumber:this.phoneNumber}),alert("تم إرسال النموذج بنجاح!"),this.name="",this.phoneNumber=""}catch(e){console.log("error",e.message),this.formError="حدث خطأ أثناء إرسال النموذج. الرجاء المحاولة مرة أخرى."}}}};const S=(0,i.A)(E,[["render",L],["__scopeId","data-v-c724056e"]]);var _=S;const N=e=>((0,a.Qi)("data-v-92185b02"),e=e(),(0,a.jt)(),e),$={class:"admin-container"},C={key:0,class:"loader"},q=N((()=>(0,a.Lk)("h1",null,"لوحة التحكم",-1))),A={class:"row mb-3"},I={class:"col"},P={class:"card"},x={class:"card-body"},O=N((()=>(0,a.Lk)("h5",{class:"card-title"},"عدد الطلبيات المرسلة",-1))),j={class:"card-text"},F={class:"col"},Q={class:"card"},M={class:"card-body"},T=N((()=>(0,a.Lk)("h5",{class:"card-title"},"عدد الطلبيات الغير مرسلة",-1))),B={class:"card-text"},R={class:"col"},W={class:"card"},X={class:"card-body"},H=N((()=>(0,a.Lk)("h5",{class:"card-title"},"عدد الطلبيات مع الصور",-1))),J={class:"card-text"},V={class:"col"},U={class:"card"},z={class:"card-body"},G=N((()=>(0,a.Lk)("h5",{class:"card-title"},"عدد الطلبيات بدون صور",-1))),Y={class:"card-text"},K={class:"col"},Z={class:"card"},ee={class:"card-body"},te=N((()=>(0,a.Lk)("h5",{class:"card-title"},"عدد الطلبيات الكلي",-1))),re={class:"card-text"},ne={class:"form-group"};function ae(e,t,r,s,o,i){const l=(0,a.g2)("ag-grid-vue");return(0,a.uX)(),(0,a.CE)("div",$,[o.loading?((0,a.uX)(),(0,a.CE)("div",C)):(0,a.Q3)("",!0),q,(0,a.Lk)("div",A,[(0,a.Lk)("div",I,[(0,a.Lk)("div",P,[(0,a.Lk)("div",x,[O,(0,a.Lk)("p",j,(0,c.v_)(i.ordersWithSendDate),1),(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>i.filterBySendDate(!0)),class:"btn btn-info"}," عرض المرسلة ")])])]),(0,a.Lk)("div",F,[(0,a.Lk)("div",Q,[(0,a.Lk)("div",M,[T,(0,a.Lk)("p",B,(0,c.v_)(i.ordersWithoutSendDate),1),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>i.filterBySendDate(!1)),class:"btn btn-warning"}," عرض الغير مرسلة ")])])]),(0,a.Lk)("div",R,[(0,a.Lk)("div",W,[(0,a.Lk)("div",X,[H,(0,a.Lk)("p",J,(0,c.v_)(i.ordersWithImages),1),(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>i.filterByImage(!0)),class:"btn btn-success"}," عرض الصور ")])])]),(0,a.Lk)("div",V,[(0,a.Lk)("div",U,[(0,a.Lk)("div",z,[G,(0,a.Lk)("p",Y,(0,c.v_)(i.ordersWithoutImages),1),(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>i.filterByImage(!1)),class:"btn btn-danger"}," عرض بدون صور ")])])]),(0,a.Lk)("div",K,[(0,a.Lk)("div",Z,[(0,a.Lk)("div",ee,[te,(0,a.Lk)("p",re,(0,c.v_)(i.totalOrders),1),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>i.filterByImage(null)),class:"btn btn-primary"}," عرض الكل ")])])])]),(0,a.Lk)("div",ne,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>o.searchQuery=e),class:"form-control",placeholder:"البحث بالاسم..."},null,512),[[n.Jo,o.searchQuery]])]),(0,a.bF)(l,{columnDefs:o.columnDefs,rowData:i.filteredRequests,domLayout:"autoHeight",gridAutoHeight:!0,class:"ag-theme-quartz custom-ag-grid",enableRtl:!0,rowHeight:40,pagination:!0},null,8,["columnDefs","rowData"])])}var se=r(3505),oe=r(9122),ie=r.n(oe),le={components:{AgGridVue:se.b},data(){return{requests:[],loading:!0,searchQuery:"",filteredImage:"",filteredSendDate:"",columnDefs:[{field:"id",headerName:"رقم",valueGetter:"node.rowIndex + 1"},{field:"name",headerName:"الاسم",sortable:!0},{field:"phoneNumber",headerName:"رقم الهاتف",sortable:!0},{headerName:"تحميل الصورة",cellRenderer:e=>{if(null!==e.data?._id){const t=document.createElement("div");return t.classList.add("btn-group"),t.innerHTML='\n                  <input\n                     className="upload__inputfile d-none"\n                     type="file"\n                     multiple=""\n                     data-max_length="20"\n                    name="imageData"\n                    accept="image/*"\n                    />\n            ',this.addClickEventListener(t,e.data),t}return""}},{headerName:"الصورة",cellRenderer:e=>{if(e.data?.urlPicture){const t=document.createElement("div");return t.classList.add("btn-group"),t.innerHTML=`\n                  <a href="${e.data?.urlPicture}" target="_blank" class="btn btn-info">فتح الصورة</a>`,t}return""}},{headerName:"إرسال",cellRenderer:this.renderSendButton},{field:"creationDate",headerName:"تاريخ الإنشاء",valueFormatter:e=>{const t=new Date(e.value),r=`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`;return r}},{field:"sendDate",headerName:"تاريخ الإرسال",valueFormatter:e=>{if(e.value){const t=new Date(e.value),r=`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`;return r}}}]}},methods:{async takePhoto(e,t){this.loading=!0;const r=t?._id;try{const t=e.target.files[0];if(t){const e=new FormData;e.append("imageData",t),e.append("orderId",r);const n=await w.A.post(`${D}/api/admin/uploadPhoto`,e,{headers:{"Content-Type":"multipart/form-data"}});200===n.status&&(this.fetchRequests(),alert("تم التقاط الصورة !")),this.loading=!1}}catch(n){this.loading=!1,console.error("Erreur lors de la prise de la photo :",n)}},renderSendButton(e){const t=e.data?.urlPicture;if(t){const t=document.createElement("div");return t.classList.add("btn-group"),t.innerHTML='<button class="btn btn-success">إرسال</button>',this.addClickEventListenerButton(t,e.data),t}return""},addClickEventListenerButton(e,t){e.addEventListener("click",(()=>this.sendPicture(t)))},addClickEventListener(e,t){e.addEventListener("change",(e=>this.takePhoto(e,t)))},async fetchRequests(){try{const e=await w.A.get(`${D}/api/admin/requests`);this.requests=e.data,this.loading=!1}catch(e){this.loading=!1,console.log("errer",e.message)}},filterByImage(e){this.resetFilters(),this.filteredImage=e},async sendPictureToManager(e,t){var r=ie().stringify({token:"x1y1nwz2fbss9sj8",to:966563466639,image:e,caption:t}),n={method:"post",url:"https://api.ultramsg.com/instance82295/messages/image",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:r};(0,w.A)(n).then((function(e){console.log(JSON.stringify(e.data))})).catch((function(e){console.log(e)}))},async sendPicture(e){try{this.loading=!0;const t=`${e?.urlPicture}`,r=ie().stringify({token:"x1y1nwz2fbss9sj8",to:e?.phoneNumber,image:t,caption:"جزاكم الله خيرًا ، ونسأل الله أن يجعل ذلك في ميزان حسناتكم."}),n={method:"post",url:"https://api.ultramsg.com/instance82295/messages/image",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:r},a=await(0,w.A)(n);console.log(JSON.stringify(a.data)),await w.A.post(`${D}/api/admin/update-send-date/${e?._id}`),await this.sendPictureToManager(t,e?.name),this.loading=!1,alert("تم إرسال الصورة إلى رقم الواتساب!")}catch(t){this.loading=!1,console.error(t)}},filterBySendDate(e){this.resetFilters(),this.filteredSendDate=e},resetFilters(){this.searchQuery="",this.filteredImage=null,this.filteredSendDate=null}},computed:{totalOrders(){return this.requests.length},ordersWithImages(){return this.requests.filter((e=>e.urlPicture)).length},ordersWithoutImages(){return this.requests.filter((e=>!e.urlPicture)).length},ordersWithSendDate(){return this.requests.filter((e=>e.sendDate)).length},ordersWithoutSendDate(){return this.requests.filter((e=>!e.sendDate)).length},filteredRequests(){let e=this.requests.filter((e=>e.name.includes(this.searchQuery)));return null!==this.filteredImage&&(e=e.filter((e=>this.filteredImage?e.urlPicture:!e.urlPicture))),null!==this.filteredSendDate&&(e=e.filter((e=>this.filteredSendDate?e.sendDate:!e.sendDate))),e}},mounted(){this.fetchRequests(),this.filteredImage=null,this.filteredSendDate=null}};const ue=(0,i.A)(le,[["render",ae],["__scopeId","data-v-92185b02"]]);var de=ue;const ce=e=>((0,a.Qi)("data-v-1e1c2ae8"),e=e(),(0,a.jt)(),e),he={class:"login-container"},me=ce((()=>(0,a.Lk)("h1",null,"تسجيل الدخول",-1))),pe=ce((()=>(0,a.Lk)("label",null,"اسم المستخدم:",-1))),fe=ce((()=>(0,a.Lk)("label",null,"كلمة المرور:",-1))),ge=ce((()=>(0,a.Lk)("button",{type:"submit"},"تسجيل الدخول",-1))),be={key:0,class:"error"};function ve(e,t,r,s,o,i){return(0,a.uX)(),(0,a.CE)("div",he,[me,(0,a.Lk)("form",{onSubmit:t[2]||(t[2]=(0,n.D$)(((...e)=>i.login&&i.login(...e)),["prevent"])),class:"login-form"},[pe,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.username=e),required:""},null,512),[[n.Jo,o.username]]),fe,(0,a.bo)((0,a.Lk)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>o.password=e),required:""},null,512),[[n.Jo,o.password]]),ge,o.loginError?((0,a.uX)(),(0,a.CE)("span",be,(0,c.v_)(o.loginError),1)):(0,a.Q3)("",!0)],32)])}r(4114);var ke={data(){return{username:"",password:"",loginError:""}},methods:{async login(){try{const e=await w.A.post(`${D}/api/admin/login`,{username:this.username,password:this.password});console.log("response",e),localStorage.setItem("isAuthenticated",!0),this.$router.push({name:"Admin"})}catch(e){e.response&&401===e.response.status?this.loginError="اسم المستخدم أو كلمة المرور غير صحيحة. الرجاء المحاولة مرة أخرى.":this.loginError="حدث خطأ أثناء عملية تسجيل الدخول. الرجاء المحاولة مرة أخرى لاحقًا."}}}};const ye=(0,i.A)(ke,[["render",ve],["__scopeId","data-v-1e1c2ae8"]]);var Le=ye;const we=[{path:"/",name:"Form",component:_},{path:"/admin",name:"Admin",component:de,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:Le}],De=(0,d.aE)({history:(0,d.LA)(),routes:we});De.beforeEach(((e,t,r)=>{const n=localStorage.getItem("isAuthenticated");e.matched.some((e=>e.meta.requiresAuth))?n?r():r({name:"Login"}):r()}));var Ee=De;(0,n.Ef)(u).mount("#app");const Se=(0,n.Ef)(u);Se.use(Ee),Se.mount("#app")},2634:function(){}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.m=e,function(){var e=[];r.O=function(t,n,a,s){if(!n){var o=1/0;for(d=0;d<e.length;d++){n=e[d][0],a=e[d][1],s=e[d][2];for(var i=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(i=!1,s<o&&(o=s));if(i){e.splice(d--,1);var u=a();void 0!==u&&(t=u)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,a,s]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,o=n[0],i=n[1],l=n[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(l)var d=l(r)}for(t&&t(n);u<o.length;u++)s=o[u],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},n=self["webpackChunkfront"]=self["webpackChunkfront"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=r.O(void 0,[504],(function(){return r(8697)}));n=r.O(n)})();
//# sourceMappingURL=app.898f6bc1.js.map